<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/avatar.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="cloudray">
  <meta name="keywords" content="">
  <title>初学爬虫（10）——实例2则 - cloudray</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 4.2.0"></head>


<body>
  <header style="height: 100vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Cloudray</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-filjiel"></i>
                主页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/%E7%94%B5%E5%AD%90.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2020-08-24 23:10">
      August 24, 2020 pm
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      35
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
            <div class="scroll-down-bar">
              <i class="iconfont icon-arrowdown"></i>
            </div>
          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
              <p class="note note-info">
                
                  本文最后更新于：August 24, 2020 pm
                
              </p>
            
            <article class="markdown-body">
              <p>&emsp;算起来，这已经是第3次打脸了，虽然严格来讲，依然符合我第一篇立下的Flag，但在这个过程中，所做所为还是有些差劲，比如上一篇刚说上周就能完结，结果昨天刚开个头就放弃了。而且今天这篇本来应该是完结篇，但是发现实例3和实例4所用的网站已经无法访问，于是便只有2例了。实例3和实例4我将作为自己的练习题来写，不再依靠课程。至于时间方面，3天吧，这次希望不要再拖到最后了。剩下还有很多想记录的，下篇再来吧。<br><img src="https://img-blog.csdnimg.cn/2020082423092523.gif#pic_center" srcset="/img/loading.gif" alt="在这里插入图片描述"></p>
<hr>
<p><strong>以下实例基于chorm浏览器，版本 84.0.4147.135（正式版本） （64 位），运行环境为python3.7.3，pycharm2019.3</strong></p>
<h1 id="实例1：中国大学排名定向爬虫"><a href="#实例1：中国大学排名定向爬虫" class="headerlink" title="实例1：中国大学排名定向爬虫"></a>实例1：中国大学排名定向爬虫</h1><h2 id="功能要求"><a href="#功能要求" class="headerlink" title="功能要求"></a>功能要求</h2><p>输入：大学排名URL链接，<a href="http://www.zuihaodaxue.com/zuihaodaxuepaiming2018.html" target="_blank" rel="noopener">http://www.zuihaodaxue.com/zuihaodaxuepaiming2018.html</a><br>输出：大学排名信息的屏幕输出（排名，大学名称，总分）<br>技术路线：requests‐bs4<br>定向爬虫：仅对输入URL进行爬取，不扩展爬取</p>
<h2 id="网页分析"><a href="#网页分析" class="headerlink" title="网页分析"></a>网页分析</h2><p>1.验证定向爬虫可行性：查看所需信息是否直接显示在HTML页面上<br>在浏览页面中，使用检查功能或直接查看网页源代码，可以发现其信息可以直接爬取，不存在动态链接，故定向爬虫可行性较高。<br><img src="https://img-blog.csdnimg.cn/20200824224928882.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzcyNjkxNA==,size_16,color_FFFFFF,t_70#pic_center" srcset="/img/loading.gif" alt="在这里插入图片描述"></p>
<p>2.查看当前网页的robots.txt，发现相关网页不存在，故可以无限制爬取<br><img src="https://img-blog.csdnimg.cn/20200824224936605.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzcyNjkxNA==,size_16,color_FFFFFF,t_70#pic_center" srcset="/img/loading.gif" alt="在这里插入图片描述"></p>
<h2 id="程序结构设计"><a href="#程序结构设计" class="headerlink" title="程序结构设计"></a>程序结构设计</h2><p>步骤1：从网络上获取大学排名网页内容。getHTMLText()<br>步骤2：提取网页内容中信息到合适的数据结构。fillUnivList()<br>步骤3：利用数据结构展示并输出结果。printUnivList()</p>
<h2 id="程序代码"><a href="#程序代码" class="headerlink" title="程序代码"></a>程序代码</h2><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup
<span class="hljs-keyword">import</span> bs4

<span class="hljs-comment">#功能：从网络上获取大学排名网页内容</span>
<span class="hljs-comment">#url： 获取网页链接</span>
<span class="hljs-comment">#返回：爬取网页信息</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getHTMLText</span><span class="hljs-params">(url)</span>:</span>
   <span class="hljs-keyword">try</span>:
      r = requests.get(url)
      r.raise_for_status()<span class="hljs-comment">#网页访问状态错误，则产生异常</span>
      r.encoding = r.apparent_encoding
      <span class="hljs-keyword">return</span> r.text
   <span class="hljs-keyword">except</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>

<span class="hljs-comment">#功能：提取网页内容中信息到合适的数据结构</span>
<span class="hljs-comment">#ulist：处理后的列表信息</span>
<span class="hljs-comment">#html：爬取网页信息</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fillUnivList</span><span class="hljs-params">(html,ulist)</span>:</span>
   soup = BeautifulSoup(html,<span class="hljs-string">'html.parser'</span>)<span class="hljs-comment">#解析网页信息</span>
   <span class="hljs-comment">#遍历tbody的子标签</span>
   <span class="hljs-keyword">for</span> tr <span class="hljs-keyword">in</span> soup.find(<span class="hljs-string">'tbody'</span>).children:
      <span class="hljs-keyword">if</span> isinstance(tr,bs4.element.Tag):
         tds = tr(<span class="hljs-string">'td'</span>)
         ulist.append([tds[<span class="hljs-number">0</span>].string,tds[<span class="hljs-number">1</span>].string,tds[<span class="hljs-number">3</span>].string])

<span class="hljs-comment">#功能：利用数据结构展示并输出结果</span>
<span class="hljs-comment">#ulist：获取列表信息</span>
<span class="hljs-comment">#num：控制显示多少排名</span>
<span class="hljs-comment">#格式化输出信息</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">printUnivList</span><span class="hljs-params">(ulist,num)</span>:</span>
    <span class="hljs-comment">#这里还未优化，打印格式错乱</span>
   print(<span class="hljs-string">"&#123;:&lt;9&#125;&#123;:^10&#125;&#123;:&gt;10&#125;"</span>.format(<span class="hljs-string">"排名"</span>,<span class="hljs-string">"学校名称"</span>,<span class="hljs-string">"总分"</span>))
   <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(num):
      u = ulist[i]
      print(<span class="hljs-string">"&#123;:&lt;10&#125;&#123;:^10&#125;&#123;:&gt;10&#125;"</span>.format(u[<span class="hljs-number">0</span>],u[<span class="hljs-number">1</span>],u[<span class="hljs-number">2</span>]))


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
   unifo = []<span class="hljs-comment">#存放信息列表</span>
   url = <span class="hljs-string">"http://www.zuihaodaxue.com/zuihaodaxuepaiming2018.html"</span>
   html = getHTMLText(url)
   fillUnivList(html,unifo)
   printUnivList(unifo,<span class="hljs-number">20</span>)</code></pre>



<p>打印结果：<br><img src="https://img-blog.csdnimg.cn/20200824225042889.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzcyNjkxNA==,size_16,color_FFFFFF,t_70#pic_center" srcset="/img/loading.gif" alt="在这里插入图片描述"></p>
<h2 id="输出格式优化："><a href="#输出格式优化：" class="headerlink" title="输出格式优化："></a>输出格式优化：</h2><p><img src="https://img-blog.csdnimg.cn/20200824225258762.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzcyNjkxNA==,size_16,color_FFFFFF,t_70#pic_center" srcset="/img/loading.gif" alt="在这里插入图片描述"></p>
<p>主要优化在将英文填字符替换成了中文填字符</p>
<pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">printUnivList</span><span class="hljs-params">(ulist,num)</span>:</span>
   tplt = <span class="hljs-string">"&#123;:^10&#125;\t&#123;:^10&#125;\t&#123;:^10&#125;"</span>
   print(tplt.format(<span class="hljs-string">"排名"</span>,<span class="hljs-string">"学校名称"</span>,<span class="hljs-string">"总分"</span>,chr(<span class="hljs-number">12288</span>)))  <span class="hljs-comment">#采用中文字符填充空格</span>
   <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(num):
      u = ulist[i]
      <span class="hljs-comment"># if len(u[1]) &gt; 4:</span>
      <span class="hljs-comment">#  print("&#123;:^10&#125;\t&#123;:^10&#125;\t&#123;:^6&#125;".format(u[0], u[1], u[2], chr(12288)))</span>
      print(tplt.format(u[<span class="hljs-number">0</span>],u[<span class="hljs-number">1</span>],u[<span class="hljs-number">2</span>],chr(<span class="hljs-number">12288</span>)))</code></pre>

<p>优化输出结果</p>
<p><img src="https://img-blog.csdnimg.cn/202008242251284.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzcyNjkxNA==,size_16,color_FFFFFF,t_70#pic_center" srcset="/img/loading.gif" alt="在这里插入图片描述"></p>
<h1 id="实例2：淘宝商品信息定向爬取"><a href="#实例2：淘宝商品信息定向爬取" class="headerlink" title="实例2：淘宝商品信息定向爬取"></a>实例2：淘宝商品信息定向爬取</h1><h2 id="功能要求-1"><a href="#功能要求-1" class="headerlink" title="功能要求"></a>功能要求</h2><p>目标：获取淘宝搜索页面的信息，提取其中的商品名称和价格<br>理解：<br>淘宝的搜索接口<br>翻页的处理<br>技术路线：requests‐bs4‐re</p>
<h2 id="网页分析："><a href="#网页分析：" class="headerlink" title="网页分析："></a>网页分析：</h2><h3 id="观察网页url链接"><a href="#观察网页url链接" class="headerlink" title="观察网页url链接"></a>观察网页url链接</h3><p>起始页：<br><code>https://s.taobao.com/search?q=书包&amp;imgfile=&amp;commend=all&amp;ssid=s5-e&amp;search_type=item&amp;sourceId=tb.index&amp;spm=a21bo.2017.201856-taobao-item.1&amp;ie=utf8&amp;initiative_id=tbindexz_20170306</code></p>
<p>第二页<br><code>https://s.taobao.com/search?q=书包&amp;imgfile=&amp;commend=all&amp;ssid=s5-e&amp;search_type=item&amp;sourceId=tb.index&amp;spm=a21bo.2017.201856-taobao-item.1&amp;ie=utf8&amp;initiative_id=tbindexz_20170306&amp;bcoffset=3&amp;ntoffset=3&amp;p4ppushleft=1%2C48&amp;s=44</code></p>
<p>第三页<br><code>https://s.taobao.com/search?q=书包&amp;imgfile=&amp;commend=all&amp;ssid=s5-e&amp;search_type=item&amp;sourceId=tb.index&amp;spm=a21bo.2017.201856-taobao-item.1&amp;ie=utf8&amp;initiative_id=tbindexz_20170306&amp;bcoffset=0&amp;ntoffset=6&amp;p4ppushleft=1%2C48&amp;s=88</code></p>
<p>可以看出，<br>淘宝搜索关键字的api：<code>https://s.taobao.com/search?q=</code> + 关键词<br>最后的&amp;s=44为翻页的首个商品标号，一页正好44个商品，可以用来翻页</p>
<h3 id="验证定向爬虫可行性："><a href="#验证定向爬虫可行性：" class="headerlink" title="验证定向爬虫可行性："></a>验证定向爬虫可行性：</h3><p>查看淘宝搜索页面的robots.txt，<a href="https://s.taobao.com/robots.txt" target="_blank" rel="noopener">https://s.taobao.com/robots.txt</a><br>发现不允许爬虫对其爬取<br><strong>此处爬虫仅作学习可用。</strong><br><img src="https://img-blog.csdnimg.cn/20200824225352949.jpg#pic_center" srcset="/img/loading.gif" alt="在这里插入图片描述"></p>
<p>若加以限制，可以在一定范围内进行爬取，在不影响其正常工作的前提下，可以进行限制性定向爬取。</p>
<h3 id="关键字分析："><a href="#关键字分析：" class="headerlink" title="关键字分析："></a>关键字分析：</h3><p>查看网页源代码，搜索相关产品信息，可以发现，其产品名称在”raw_title”标签下，展示价格则在”view_price”下，<br>“view_price”:”189.00”<br>“raw_title”:”瑞士男旅行背包容量高中大学初中学生书包”<br><img src="https://img-blog.csdnimg.cn/20200824225518688.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzcyNjkxNA==,size_16,color_FFFFFF,t_70#pic_center" srcset="/img/loading.gif" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200824225518646.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzcyNjkxNA==,size_16,color_FFFFFF,t_70#pic_center" srcset="/img/loading.gif" alt="在这里插入图片描述"></p>
<p>此处商品信息是直接显示在文本中的，虽然包含在html页面中，但却是一种脚本语言的体现，不是一个完整的HTML页面的表示，这里没有使用beautiful库进行解析，直接使用正则表达式。</p>
<h3 id="获取网页headers："><a href="#获取网页headers：" class="headerlink" title="获取网页headers："></a>获取网页headers：</h3><p>在爬取时，需要登录淘宝账号，并在检查代码中获取header，<strong>否则爬取会出错！！！</strong><br>即右边的Request Headers</p>
<p><img src="https://img-blog.csdnimg.cn/20200824225603478.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzcyNjkxNA==,size_16,color_FFFFFF,t_70#pic_center" srcset="/img/loading.gif" alt="在这里插入图片描述"></p>
<h2 id="程序结构"><a href="#程序结构" class="headerlink" title="程序结构"></a>程序结构</h2><p>步骤1：提交商品搜索请求，循环获取页面。getHTMLText(url)<br>步骤2：对于每个页面，提取商品名称和价格信息。parsePage(ilt, html)<br>步骤3：将信息输出到屏幕上。printGoodsList(ilt)</p>
<h2 id="程序设计"><a href="#程序设计" class="headerlink" title="程序设计"></a>程序设计</h2><p><strong>此处去掉了所有try,except结构，方便调试。</strong></p>
<pre><code class="hljs python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> re

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getHTMLText</span><span class="hljs-params">(url)</span>:</span>
    <span class="hljs-comment">#以下header是从爬取页面读取的</span>
    header = &#123;
        <span class="hljs-string">"Accept"</span>: <span class="hljs-string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"</span>,
        <span class="hljs-string">"Accept-Encoding"</span> : <span class="hljs-string">"gzip, deflate, br"</span>,
        <span class="hljs-string">"Accept-Language"</span>: <span class="hljs-string">"zh-CN,zh;q=0.9"</span>,
        <span class="hljs-string">"Cache-Control"</span>: <span class="hljs-string">"max-age=0"</span>,
        <span class="hljs-string">"Connection"</span>: <span class="hljs-string">"keep-alive"</span>,
        <span class="hljs-string">"Cookie"</span>:<span class="hljs-string">"thw=cn; miid=675329031576333512; hng=CN%7Czh-CN%7CCNY%7C156; tg=0; tracknick=tb98580672; enc=Rc9Wd62ZR1gn6E71Em%2FwZKxp%2Bepyhh%2BWaM23%2B2bdl3mdpMS68kW21kFdJ%2FwgKjn9YKti7J2U0KCiBfnfrAVthA%3D%3D; t=c782c3ab3d6348d1712a75b2762f1c30; cna=rtWqF+VZNB8CASQiUcw0k8Nc; v=0; _tb_token_=f3eee39eeb151; _m_h5_tk=439628e4aaf33dd7444a105e12f1483b_1598276764341; _m_h5_tk_enc=f312fa82a1b1edf5a5ca8677cbf97d21; alitrackid=www.taobao.com; _samesite_flag_=true; cookie2=19d21529363825b2fddefbc71f3b1f8c; sgcookie=ERXdqrlqF2t4XqDIhSnZW; unb=3978847415; uc3=nk2=F5RMEYeeWzYePQ%3D%3D&amp;lg2=VFC%2FuZ9ayeYq2g%3D%3D&amp;id2=UNkweIxWGQUm9w%3D%3D&amp;vt3=F8dCufTOLZ%2Bku9KZYTs%3D; csg=0e38c692; lgc=tb98580672; cookie17=UNkweIxWGQUm9w%3D%3D; dnk=tb98580672; skt=b3ebc7d090ac9d04; existShop=MTU5ODI3MTgyNw%3D%3D; uc4=nk4=0%40FY4HVFweRf4MwO79ZLZu6rfJgOfD&amp;id4=0%40Ug46tyo4o7mtNanwTv3XtPrxDhXI; _cc_=WqG3DMC9EA%3D%3D; _l_g_=Ug%3D%3D; sg=25f; _nk_=tb98580672; cookie1=B0E0lSJVJTRHPxaiLB6imzFj3im4FjjVqTL5g0BzekE%3D; lastalitrackid=login.taobao.com; mt=ci=12_1; xlly_s=1; JSESSIONID=4C3D9CBDE6E782C1BA5C03B6D3E6A445; uc1=cookie16=Vq8l%2BKCLySLZMFWHxqs8fwqnEw%3D%3D&amp;pas=0&amp;existShop=false&amp;cookie15=VFC%2FuZ9ayeYq2g%3D%3D&amp;cookie21=URm48syIYB3rzvI4Dim4&amp;cookie14=UoTV5OhfiTSBJw%3D%3D; tfstk=c_lABOcb83xmxTz-8xpu543vSYlOaqbYjZZO6en-_nS9yaXhLsAstX3YrKaND7LR.; l=eBa8SBqlQv9cG5WDBOfwhurza77thIRfguPzaNbMiOCPOX165T2cWZPDPKLBCnGVH6oyR3-WSGYuBATRZyIZGhZfP3k_J_2s3dC..; isg=BFNTgu6oCDknkcVZ-Os_qStR4td9COfKOYKjGgVwx3KphHImjdyRGtCevvTqJD_C"</span>,

        <span class="hljs-string">"Sec-Fetch-Dest"</span>: <span class="hljs-string">"document"</span>,
        <span class="hljs-string">"Sec-Fetch-Mode"</span>: <span class="hljs-string">"navigate"</span>,
        <span class="hljs-string">"Sec-Fetch-Site"</span>: <span class="hljs-string">"same-site"</span>,
        <span class="hljs-string">"Sec-Fetch-User"</span>: <span class="hljs-string">"?1"</span>,
        <span class="hljs-string">"User-Agent"</span>: <span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"</span>
    &#125;
    r = requests.get(url, timeout=<span class="hljs-number">30</span>,headers = header)
    r.raise_for_status()
    r.encoding = r.apparent_encoding
    <span class="hljs-keyword">return</span> r.text


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parsePage</span><span class="hljs-params">(ilt, html)</span>:</span>
    <span class="hljs-comment">#正则表达式中的\意思是将下一个字符标记为或特殊字符、或原义字符、或向后引用、或八进制转义符。</span>
    plt = re.findall(<span class="hljs-string">r'\"view_price\"\:\"[\d\.]*\"'</span>, html)<span class="hljs-comment">#价格</span>
    <span class="hljs-comment">#最小匹配，只取得最后一个双引号为止的内容，约束匹配内容</span>
    tlt = re.findall(<span class="hljs-string">r'\"raw_title\"\:\".*?\"'</span>, html)<span class="hljs-comment">#标题</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(plt)):
        price = eval(plt[i].split(<span class="hljs-string">':'</span>)[<span class="hljs-number">1</span>])
        title = eval(tlt[i].split(<span class="hljs-string">':'</span>)[<span class="hljs-number">1</span>])
        ilt.append([price, title])
        
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">printGoodsList</span><span class="hljs-params">(ilt)</span>:</span>
    tplt = <span class="hljs-string">"&#123;:4&#125;\t&#123;:8&#125;\t&#123;:16&#125;"</span>
    print(tplt.format(<span class="hljs-string">"序号"</span>, <span class="hljs-string">"价格"</span>, <span class="hljs-string">"商品名称"</span>))
    count = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> g <span class="hljs-keyword">in</span> ilt:
        count = count + <span class="hljs-number">1</span>
        print(tplt.format(count, g[<span class="hljs-number">0</span>], g[<span class="hljs-number">1</span>]))


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span>
    goods = <span class="hljs-string">'书包'</span>
    depth = <span class="hljs-number">3</span> <span class="hljs-comment">#爬取页面深度</span>
    start_url = <span class="hljs-string">'https://s.taobao.com/search?q='</span> + goods
    infoList = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(depth):
        url = start_url + <span class="hljs-string">'&amp;s='</span> + str(<span class="hljs-number">44</span> * i)
        html = getHTMLText(url)
        <span class="hljs-comment"># print(html)</span>
        parsePage(infoList, html)
    printGoodsList(infoList)

main()</code></pre>

<p>运行结果<br><img src="https://img-blog.csdnimg.cn/20200824225701713.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzcyNjkxNA==,size_16,color_FFFFFF,t_70#pic_center" srcset="/img/loading.gif" alt="在这里插入图片描述"></p>
<p><strong>由于实例3和实例4中所要爬取的网站已经无法访问，故此先跳过这两个实例，后面再补。</strong></p>
<h1 id="课程来源：北京理工大学MOOC"><a href="#课程来源：北京理工大学MOOC" class="headerlink" title="课程来源：北京理工大学MOOC"></a>课程来源：<a href="https://www.icourse163.org/learn/BIT-1001870001?tid=1450316449#/learn/announce" target="_blank" rel="noopener">北京理工大学MOOC</a></h1>
            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/python/">python</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/">学习记录</a>
                    
                      <a class="hover-with-bg" href="/tags/%E7%88%AC%E8%99%AB/">爬虫</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/08/29/%E5%88%9D%E5%AD%A6%E7%88%AC%E8%99%AB%EF%BC%8811%EF%BC%89%E2%80%94%E2%80%94%E8%82%A1%E7%A5%A8%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%EF%BC%8C%E7%88%AC%E8%99%AB%E5%AD%A6%E4%B9%A0%E6%9A%82%E5%91%8A%E4%B8%80%E6%AE%B5%E8%90%BD/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">初学爬虫（11）——股票数据分析，爬虫学习暂告一段落</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/08/22/%E5%88%9D%E5%AD%A6%E7%88%AC%E8%99%AB%EF%BC%889%EF%BC%89%E2%80%94%E2%80%94Scrapy%E6%A1%86%E6%9E%B6%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/">
                        <span class="hidden-mobile">初学爬虫（9）——Scrapy框架基础使用</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


    

    
  </div>
</footer>
<div id="music163player">
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1206866&auto=1&height=66"></iframe>
</div>
<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "初学爬虫（10）——实例2则&nbsp;",
      ],
      cursorChar: "",
      typeSpeed: 50,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  











  

  

  

  

  

  





<script src="/node_modules/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"node_modules/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/node_modules/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body>
</html>
